<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.complitex.flexbuh.service.dictionary.TaxInspectionBean">
    <resultMap id="taxInspectionResultMap" type="org.complitex.flexbuh.entity.dictionary.TaxInspection"
               extends="org.complitex.flexbuh.entity.dictionary.AbstractPeriodDictionary.periodDictionaryResultMap">
        <result property="code" column="code"/>
        <result property="regionCode" column="region_code"/>
        <result property="codeArea" column="code_area"/>
        <result property="codeTaxInspectionType" column="code_tax_inspection_type"/>

        <result property="areaNameRu" column="area_name_ru"/>
        <result property="areaNameUk" column="area_name_uk"/>
    </resultMap>

    <insert id="insertTaxInspection" parameterType="org.complitex.flexbuh.entity.dictionary.TaxInspection" keyProperty="id" useGeneratedKeys="true">
        insert into `tax_inspection`
          (`upload_date`, `begin_date`, `end_date`, `code`, `region_code`,`code_area`, `code_tax_inspection_type`,
            `name_ru`, `name_uk`, `area_name_ru`, `area_name_uk`)
        values
          (#{uploadDate}, #{beginDate}, #{endDate}, #{code}, #{regionCode}, #{codeArea}, #{codeTaxInspectionType},
            #{nameRu}, #{nameUk}, #{areaNameRu}, #{areaNameUk})
    </insert>

    <select id="selectAllTaxInspectionsCodeWithName" resultMap="taxInspectionResultMap">
		select distinct `code`, `name_ru`, `name_uk`
		    from `tax_inspection`
        	where (`begin_date` &lt; now() or `begin_date` is null) and (`end_date` &gt; now() or `end_date` is null)
        	order by `name_uk`, `name_ru`
    </select>

    <select id="selectAllTaxInspectionsCount" resultType="int">
        select count(*) from `tax_inspection`
    </select>

    <select id="selectTaxInspections" parameterType="org.complitex.flexbuh.entity.AbstractFilter" resultMap="taxInspectionResultMap">
        select * from `tax_inspection` order by `code` limit #{first}, #{count}
    </select>

    <select id="selectTaxInspection" parameterType="long" resultMap="taxInspectionResultMap">
        select * from `tax_inspection` where `id` = #{id}
    </select>

	<select id="selectTaxInspectionByCode" parameterType="int" resultMap="taxInspectionResultMap">
        select * from `tax_inspection` where `code` = #{code}
    </select>
</mapper>