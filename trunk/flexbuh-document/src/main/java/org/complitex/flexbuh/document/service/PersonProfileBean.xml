<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.complitex.flexbuh.document.service.PersonProfileBean">
    <resultMap id="personProfileResultMap" type="org.complitex.flexbuh.document.entity.PersonProfile">
        <id column="id" property="id"/>
        <result column="session_id" property="sessionId"/>
        <result column="person_type" property="personType"/>
        <result column="c_sti" property="cSti"/>
        <result column="c_sti_tin" property="cStiTin"/>
        <result column="tin" property="tin"/>
        <result column="name" property="name"/>
        <result column="num_pvd_svd" property="numPvdSvd"/>
        <result column="ipn" property="ipn"/>
        <result column="kved" property="kved"/>
        <result column="koatuu" property="koatuu"/>
        <result column="contract_date" property="contractDate"/>
        <result column="contract_number" property="contractNumber"/>
        <result column="zip_code" property="zipCode"/>
        <result column="address" property="address"/>
        <result column="phone" property="phone"/>
        <result column="fax" property="fax"/>
        <result column="email" property="email"/>
        <result column="d_inn" property="dInn"/>
        <result column="d_fio" property="dFio"/>
        <result column="b_inn" property="bInn"/>
        <result column="b_fio" property="bFio"/>
    </resultMap>

    <insert id="insertPersonProfile" parameterType="org.complitex.flexbuh.document.entity.PersonProfile" keyProperty="id" useGeneratedKeys="true">
        insert into `person_profile`
          (`session_id`, `person_type`, `c_sti`, `c_sti_tin`, `tin`, `name`, `num_pvd_svd`, `ipn`, `kved`, `koatuu`,
            `contract_date`, `contract_number`, `zip_code`, `address`, `phone`, `fax`, `email`, `d_inn` , `d_fio`,
            `b_inn`, `b_fio`)
        values
          (#{sessionId}, #{personType}, #{cSti}, #{cStiTin}, #{tin}, #{name}, #{numPvdSvd}, #{ipn},
            #{kved}, #{koatuu}, #{contractDate}, #{contractNumber}, #{zipCode}, #{address}, #{phone}, #{fax}, #{email},
            #{dInn}, #{dFio}, #{bInn}, #{bFio})
    </insert>

	<update id="updatePersonProfile" parameterType="org.complitex.flexbuh.document.entity.PersonProfile">
        update `person_profile` set `person_type` = #{personType}, `c_sti` = #{cSti}, `c_sti_tin` = #{cStiTin},
          `tin` = #{tin}, `name` = #{name}, `num_pvd_svd` = #{numPvdSvd}, `ipn` = #{ipn}, `kved` = #{kved},
          `koatuu` = #{koatuu}, `contract_date` = #{contractDate}, `contract_number` = #{contractNumber},
          `zip_code` = #{zipCode}, `address` = #{address}, `phone` = #{phone}, `fax` = #{fax}, `email` = #{email},
          `d_inn` = #{dInn}, `d_fio` = #{dFio}, `b_inn` = #{bInn}, `b_fio` = #{bFio}
        where `id` = #{id}
    </update>

    <select id="selectPersonProfile" parameterType="long" resultMap="personProfileResultMap">
        select * from `person_profile` where `id` = #{id}
    </select>

    <select id="selectPersonProfiles" parameterType="org.complitex.flexbuh.entity.AbstractFilter" resultMap="personProfileResultMap">
        select * from `person_profile` where `session_id` = #{sessionId} limit #{first}, #{count}
    </select>

    <select id="selectPersonProfilesCount" parameterType="long" resultType="int">
        select count(*) from `person_profile` where `session_id` = #{sessionId}
    </select>
</mapper>